{% load static %}
<!doctype html>
{% if request.user.is_authenticated %}
<html lang="ru" data-theme="{{ request.user.profile.ui_theme }}">
{% else %}
<html lang="ru" data-theme="dark">
{% endif %}

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="–í—Å—ë–≤–°–µ—Ä—å–µ–∑ - —Å–∞–π—Ç –∑–Ω–∞–∫–æ–º—Å—Ç–≤ –¥–ª—è —Å–µ—Ä—å–µ–∑–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π" />
  <title>{% block title %}–í—Å—ë–í—Å–µ—Ä—å—ë–∑{% endblock %}</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
  <script src="{% static 'app.js' %}"></script>

  <style>
    :root { color-scheme: dark; }
    :root[data-theme="light"] { color-scheme: light; }

    html[data-theme="light"] .blob { opacity: .55; }
    html[data-theme="light"] .glass { background: rgba(0,0,0,.03); border-color: rgba(0,0,0,.08); }

    html[data-theme="light"] input:not([type="checkbox"]):not([type="radio"]),
    html[data-theme="light"] textarea,
    html[data-theme="light"] select {
      background: rgba(0,0,0,.03) !important;
      border-color: rgba(0,0,0,.10) !important;
      color: rgb(15 23 42) !important;
    }

    @media (prefers-reduced-motion: reduce) {
      * { scroll-behavior: auto !important; }
      *, *::before, *::after { animation-duration: 0.001ms !important; animation-iteration-count: 1 !important; transition-duration: 0.001ms !important; }
    }

    html { scroll-behavior: smooth; }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pop {
      0% { transform: scale(0.98); }
      100% { transform: scale(1); }
    }

    @keyframes shimmer {
      0% { transform: translateX(-60%); }
      100% { transform: translateX(160%); }
    }

    @keyframes floatBlob {
      0% { transform: translate3d(0, 0, 0) scale(1); }
      50% { transform: translate3d(0, -18px, 0) scale(1.03); }
      100% { transform: translate3d(0, 0, 0) scale(1); }
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .blob { animation: floatBlob 9s ease-in-out infinite; will-change: transform; }
    .blob.b2 { animation-duration: 11s; animation-delay: -2.2s; }
    .blob.b3 { animation-duration: 13s; animation-delay: -4.6s; }

    .reveal-init {
      opacity: 0;
      transform: translateY(12px);
      transition: opacity 500ms cubic-bezier(.2,.8,.2,1), transform 500ms cubic-bezier(.2,.8,.2,1);
      will-change: opacity, transform;
    }
    .reveal-show { opacity: 1; transform: translateY(0); }

    .btn-press { transform: translateY(0); transition: transform 140ms ease, filter 140ms ease; }
    .btn-press:active { transform: translateY(1px); filter: brightness(1.08); }

    .glass {
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .shine { position: relative; overflow: hidden; }
    .shine::after {
      content: "";
      position: absolute;
      top: 0;
      left: -60%;
      width: 45%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.14), transparent);
      transform: skewX(-18deg);
      opacity: 0;
      pointer-events: none;
    }
    .shine:hover::after {
      opacity: 1;
      animation: shimmer 900ms ease;
    }

    .slideIn {
      animation: slideIn 300ms ease-out;
    }

    /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º */
    input[type="file"]::file-selector-button {
      padding: 0.5rem 1rem;
      margin-right: 1rem;
      border: 0;
      border-radius: 0.5rem;
      background-color: rgba(255,255,255,.10);
      color: rgb(226, 232, 240);
      cursor: pointer;
      transition: background-color 200ms;
    }

    input[type="file"]::file-selector-button:hover {
      background-color: rgba(255,255,255,.15);
    }

    /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* –ü–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */
    .modal-content {
      max-height: 90vh;
      overflow-y: auto;
    }
  </style>
</head>

{% if request.user.is_authenticated %}
<body class="min-h-screen overflow-x-hidden {% if request.user.profile.ui_theme == 'light' %}bg-slate-50 text-slate-950{% else %}bg-slate-950 text-slate-100{% endif %}">
{% else %}
<body class="min-h-screen overflow-x-hidden bg-slate-950 text-slate-100">
{% endif %}

  <div class="pointer-events-none fixed inset-0 overflow-hidden">
    <div class="blob absolute -top-24 -left-24 h-72 w-72 rounded-full bg-fuchsia-500/25 blur-3xl"></div>
    <div class="blob b2 absolute top-24 right-[-6rem] h-96 w-96 rounded-full bg-indigo-500/25 blur-3xl"></div>
    <div class="blob b3 absolute bottom-[-8rem] left-1/3 h-96 w-96 rounded-full bg-cyan-500/20 blur-3xl"></div>
  </div>

  <header class="sticky top-0 z-50 border-b border-white/10 {% if request.user.is_authenticated and request.user.profile.ui_theme == 'light' %}bg-slate-50/95{% else %}bg-slate-950/70{% endif %} backdrop-blur supports-[backdrop-filter]:bg-slate-950/60">
    <div class="mx-auto flex max-w-6xl items-center justify-between px-4 py-3 sm:px-6">
      <a href="{% url 'landing' %}" class="flex items-center gap-2 font-bold tracking-tight transition-transform duration-200 hover:scale-105">
        <span class="text-white">–í—Å—ë</span><span class="text-fuchsia-400">–≤—Å–µ—Ä—å—ë–∑</span>
      </a>

      <button id="mobile-menu-btn" type="button" class="rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-sm font-medium transition-colors hover:bg-white/10 sm:hidden">
        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>

      <nav class="hidden items-center gap-2 text-sm sm:flex">
        {% if request.user.is_authenticated %}
        <a class="rounded-lg px-3 py-2 transition-colors hover:bg-white/10 btn-press" href="{% url 'feed' %}">–õ–µ–Ω—Ç–∞</a>
        <a class="rounded-lg px-3 py-2 transition-colors hover:bg-white/10 btn-press" href="{% url 'matches' %}">–ú—ç—Ç—á–∏</a>
        <a class="relative rounded-lg px-3 py-2 transition-colors hover:bg-white/10 btn-press" href="{% url 'notifications' %}">
          –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
          {% if unread_notifications_count %}
          <span class="ml-2 inline-flex min-w-[1.25rem] items-center justify-center rounded-full bg-fuchsia-500 px-1.5 py-0.5 text-[10px] font-semibold text-white">{{ unread_notifications_count }}</span>
          {% endif %}
        </a>
        <a class="rounded-lg px-3 py-2 transition-colors hover:bg-white/10 btn-press" href="{% url 'chat_inbox' %}">–ß–∞—Ç</a>
        <a class="rounded-lg px-3 py-2 transition-colors hover:bg-white/10 btn-press" href="{% url 'me' %}">–ü—Ä–æ—Ñ–∏–ª—å</a>
        <a class="rounded-lg px-3 py-2 transition-colors hover:bg-white/10 btn-press" href="{% url 'account_settings' %}">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
        {% if request.user.is_staff %}
        <a class="rounded-lg bg-white/10 px-3 py-2 transition-colors hover:bg-white/15 btn-press" href="{% url 'panel_dashboard' %}">–ü–∞–Ω–µ–ª—å</a>
        {% endif %}
        <form method="post" action="{% url 'logout' %}" class="contents">
          {% csrf_token %}
          <button class="rounded-lg bg-white/10 px-3 py-2 transition-colors hover:bg-white/15 btn-press" type="submit">–í—ã–π—Ç–∏</button>
        </form>
        {% else %}
        <a class="rounded-lg px-3 py-2 transition-colors hover:bg-white/10 btn-press" href="{% url 'login' %}">–í–æ–π—Ç–∏</a>
        <a class="rounded-lg bg-gradient-to-r from-fuchsia-600 to-fuchsia-500 px-3 py-2 font-medium text-white transition-all hover:shadow-lg hover:shadow-fuchsia-500/25 shine btn-press"
          href="{% url 'register' %}">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
        {% endif %}
      </nav>
    </div>

    <div id="mobile-menu" class="hidden border-t border-white/10 {% if request.user.is_authenticated and request.user.profile.ui_theme == 'light' %}bg-slate-50{% else %}bg-slate-950/80{% endif %} px-4 py-3 sm:hidden">
      <div class="mx-auto flex max-w-6xl flex-col gap-2 text-sm">
        {% if request.user.is_authenticated %}
        <a class="rounded-lg px-3 py-2 transition-colors hover:bg-white/10 btn-press" href="{% url 'feed' %}">–õ–µ–Ω—Ç–∞</a>
        <a class="rounded-lg px-3 py-2 transition-colors hover:bg-white/10 btn-press" href="{% url 'matches' %}">–ú—ç—Ç—á–∏</a>
        <a class="flex items-center justify-between rounded-lg px-3 py-2 transition-colors hover:bg-white/10 btn-press" href="{% url 'notifications' %}">
          <span>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
          {% if unread_notifications_count %}
          <span class="inline-flex min-w-[1.25rem] items-center justify-center rounded-full bg-fuchsia-500 px-1.5 py-0.5 text-[10px] font-semibold text-white">{{ unread_notifications_count }}</span>
          {% endif %}
        </a>
        <a class="rounded-lg px-3 py-2 transition-colors hover:bg-white/10 btn-press" href="{% url 'chat_inbox' %}">–ß–∞—Ç</a>
        <a class="rounded-lg px-3 py-2 transition-colors hover:bg-white/10 btn-press" href="{% url 'me' %}">–ü—Ä–æ—Ñ–∏–ª—å</a>
        <a class="rounded-lg px-3 py-2 transition-colors hover:bg-white/10 btn-press" href="{% url 'account_settings' %}">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
        {% if request.user.is_staff %}
        <a class="rounded-lg bg-white/10 px-3 py-2 transition-colors hover:bg-white/15 btn-press" href="{% url 'panel_dashboard' %}">–ü–∞–Ω–µ–ª—å</a>
        {% endif %}
        <form method="post" action="{% url 'logout' %}">
          {% csrf_token %}
          <button class="w-full rounded-lg bg-white/10 px-3 py-2 text-left transition-colors hover:bg-white/15 btn-press" type="submit">–í—ã–π—Ç–∏</button>
        </form>
        {% else %}
        <a class="rounded-lg px-3 py-2 transition-colors hover:bg-white/10 btn-press" href="{% url 'login' %}">–í–æ–π—Ç–∏</a>
        <a class="rounded-lg bg-fuchsia-500 px-3 py-2 font-medium text-white transition-all hover:bg-fuchsia-400 shine btn-press" href="{% url 'register' %}">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
        {% endif %}
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-6xl px-4 py-8 sm:px-6">
    {% if messages %}
    <div class="mb-6 space-y-2" data-reveal>
      {% for message in messages %}
      <div class="slideIn rounded-xl border px-4 py-3 text-sm {% if 'success' in message.tags %}border-emerald-400/20 bg-emerald-500/10 text-emerald-100{% elif 'error' in message.tags %}border-rose-400/20 bg-rose-500/10 text-rose-100{% elif 'warning' in message.tags %}border-amber-400/20 bg-amber-500/10 text-amber-100{% else %}border-white/10 bg-white/5 text-slate-100{% endif %}">
        {{ message }}
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <div data-reveal>
      {% block content %}{% endblock %}
    </div>
  </main>

  <footer class="border-t border-white/10 bg-slate-950/30 py-8 text-center text-sm text-slate-400 mt-16">
    <div class="mx-auto max-w-6xl px-4">
      <p>&copy; 2026 –í—Å—ë–í—Å–µ—Ä—å—ë–∑. –ù–∞–π–¥–∏ —Å–µ—Ä—å–µ–∑–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è.</p>
      <p class="mt-2 text-xs">–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ —Å –ª—é–±–æ–≤—å—é üíú</p>
    </div>
  </footer>

  <script>
    (function () {
      const base = ['w-full', 'rounded-xl', 'border', 'border-white/10', 'bg-slate-900/40', 'px-3', 'py-2.5', 'text-slate-100', 'placeholder:text-slate-500', 'focus:outline-none', 'focus:ring-2', 'focus:ring-fuchsia-400/60', 'transition-colors'];
      const file = ['w-full', 'rounded-xl', 'border', 'border-white/10', 'bg-slate-900/40', 'px-3', 'py-2.5', 'text-slate-100', 'file:mr-4', 'file:rounded-lg', 'file:border-0', 'file:bg-white/10', 'file:px-4', 'file:py-2', 'file:text-slate-100', 'file:transition-colors', 'hover:file:bg-white/15'];

      document.querySelectorAll('input, textarea, select').forEach((el) => {
        if (el.type === 'checkbox' || el.type === 'radio') {
          return;
        }

        if (el.type === 'file') {
          el.classList.add(...file);
          return;
        }
        el.classList.add(...base);
      });

      document.querySelectorAll('textarea').forEach((el) => {
        el.classList.add('resize-none');
      });

      document.querySelectorAll('form label[for]').forEach((el) => {
        el.classList.add('mb-2', 'block', 'text-sm', 'font-medium', 'text-slate-200');
      });

      const interactiveTransition = ['transition', 'duration-200', 'ease-out'];
      document.querySelectorAll('button, a').forEach((el) => {
        if (!(el instanceof HTMLElement)) return;
        const cls = (el.getAttribute('class') || '').trim();
        if (!cls) return;

        if (cls.includes('rounded') || cls.includes('rounded-')) {
          el.classList.add(...interactiveTransition);
        }

        if (el.tagName.toLowerCase() === 'button') {
          el.classList.add('focus:outline-none', 'focus:ring-2', 'focus:ring-fuchsia-400/50');
        }
      });

      const btn = document.getElementById('mobile-menu-btn');
      const menu = document.getElementById('mobile-menu');
      if (btn && menu) {
        btn.addEventListener('click', function () {
          menu.classList.toggle('hidden');
        });
      }

      // Reveal animation
      document.querySelectorAll('[data-reveal]').forEach((el) => {
        el.classList.add('reveal-init');
        setTimeout(() => {
          el.classList.add('reveal-show');
        }, 50);
      });
    })();
  </script>

</body>

</html>