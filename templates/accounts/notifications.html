{% extends 'base.html' %}

{% block title %}Уведомления{% endblock %}

{% block content %}
<div class="mx-auto max-w-3xl" data-reveal>
  <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
    <div>
      <h1 class="text-2xl font-semibold tracking-tight">Уведомления</h1>
      <p class="mt-1 text-sm text-slate-300">События внутри сайта: мэтчи, сообщения и другое.</p>
    </div>

    {% if notifications %}
    <form method="post" action="{% url 'notifications_mark_all_read' %}">
      {% csrf_token %}
      <button type="submit" class="rounded-xl border border-white/10 bg-white/5 px-4 py-2 text-sm font-medium hover:bg-white/10">Отметить всё прочитанным</button>
    </form>
    {% endif %}
  </div>

  <div class="mt-8 grid gap-3">
    {% for n in notifications %}
    <div class="rounded-3xl border border-white/10 bg-white/5 p-5 {% if not n.is_read %}ring-1 ring-fuchsia-400/25{% endif %}">
      <div class="flex items-start justify-between gap-4">
        <div class="min-w-0">
          <div class="flex items-center gap-2">
            <div class="font-semibold truncate">{{ n.title }}</div>
            {% if not n.is_read %}
            <span class="rounded-full bg-fuchsia-500/20 px-2 py-0.5 text-xs text-fuchsia-200">новое</span>
            {% endif %}
          </div>
          {% if n.body %}
          <div class="mt-1 text-sm text-slate-300">{{ n.body }}</div>
          {% endif %}
          <div class="mt-2 text-xs text-slate-400">{{ n.created_at|date:"d.m.Y H:i" }}</div>
        </div>

        <div class="flex shrink-0 flex-col gap-2 sm:flex-row sm:items-center">
          {% if n.url %}
          <a class="rounded-xl bg-white/10 px-4 py-2 text-sm font-medium hover:bg-white/15" href="{{ n.url }}">Открыть</a>
          {% endif %}
          {% if not n.is_read %}
          <form method="post" action="{% url 'notifications_mark_read' n.id %}">
            {% csrf_token %}
            <button type="submit" class="rounded-xl border border-white/10 bg-white/5 px-4 py-2 text-sm font-medium hover:bg-white/10">Прочитано</button>
          </form>
          {% endif %}
        </div>
      </div>
    </div>
    {% empty %}
    <div class="rounded-3xl border border-white/10 bg-white/5 p-8 text-sm text-slate-300">
      Пока уведомлений нет.
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
